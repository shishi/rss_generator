# config/sites.yml
sites:
  # ======================================
  # yanmaga.jp - 標準CSSセレクターモード
  # ======================================
  - name: "聖巡エクスタシー"
    id: "yanmaga-seijun"
    url: "https://yanmaga.jp/comics/%E8%81%96%E5%B7%A1%E3%82%A8%E3%82%AF%E3%82%B9%E3%82%BF%E3%82%B7%E3%83%BC_%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8%E5%87%BA%E3%82%89%E3%82%8C%E3%81%AA%E3%81%84%E9%83%A8%E5%B1%8B%E3%81%A7%E9%AD%94%E6%97%8F%E3%82%92%E3%83%96%E3%83%83%E5%80%92%E3%81%97%E3%81%BE%E3%81%99"
    selectors:
      episode_list: ".mod-episode-item"
      episode_title: ".mod-episode-title"
      episode_url: ".mod-episode-link"
      episode_date: ".mod-episode-date"
    wait_for: ".mod-episode-list"
    exclude_selector: "[data-is-free='false']"

  # ======================================
  # manga-one.com - JavaScript評価モード
  # SPAサイトのためカスタムスクリプトで抽出
  # ======================================
  - name: "雷雷雷"
    id: "mangaone-rairairai"
    url: "https://manga-one.com/manga/2341/chapter/212119"
    base_url: "https://manga-one.com"
    manga_id: "2341"
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    wait_seconds: 8
    extraction_script: |
      () => {
        const mangaId = "2341";
        const episodes = [];
        const cards = document.querySelectorAll('div.cursor-pointer');

        cards.forEach(card => {
          const titleP = card.querySelector('p.font-bold');
          if (!titleP) return;

          const title = titleP.textContent.trim();
          if (!title.match(/第\d+話/)) return;

          const subtitleP = titleP.parentElement.querySelector('p:not(.font-bold)');
          const subtitle = subtitleP ? subtitleP.textContent.trim() : '';

          const dateP = card.querySelector('p.text-gray-700');
          const date = dateP ? dateP.textContent.trim() : '';

          const img = card.querySelector('img[src*="/chapter/"]');
          let chapterId = '';
          if (img) {
            const match = img.src.match(/\/chapter\/(\d+)\.webp/);
            if (match) chapterId = match[1];
          }

          const url = chapterId ? '/manga/' + mangaId + '/chapter/' + chapterId : '';

          episodes.push({
            title: title + (subtitle ? ' ' + subtitle : ''),
            url: url,
            date: date
          });
        });

        return episodes;
      }

  # ======================================
  # corocoro.jp - JavaScript評価モード
  # Next.js製SPAのためカスタムスクリプトで抽出
  # ======================================
  - name: "勝利の女神：NIKKE すいーとえんかうんと"
    id: "corocoro-nikke"
    url: "https://www.corocoro.jp/title/29"
    base_url: "https://www.corocoro.jp"
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    wait_seconds: 5
    extraction_script: |
      () => {
        const episodes = [];
        document.querySelectorAll('ul.divide-y').forEach(list => {
          list.querySelectorAll(':scope > li').forEach(item => {
            const img = item.querySelector('img[alt]');
            if (!img) return;

            const title = img.alt.replace(/\s*の話サムネイル$/, '').trim();
            if (!title) return;

            // 画像srcからchapter IDを抽出: /chapter/48511.webp → 48511
            const srcMatch = img.src.match(/\/chapter\/(\d+)\.webp/);
            const chapterId = srcMatch ? srcMatch[1] : '';
            const url = chapterId ? '/chapter/' + chapterId + '/viewer' : '';

            const dateMatch = item.textContent.match(/(\d{4}\/\d{2}\/\d{2})/);
            const date = dateMatch ? dateMatch[1].replace(/\//g, '-') : '';

            episodes.push({ title, url, date });
          });
        });
        return episodes;
      }
